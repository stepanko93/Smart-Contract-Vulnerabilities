// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

/**
 * @title STBL Protocol - Decimal Mismatch Functional Test
 * @notice Demonstrates 1e12x reward theft due to lack of decimal normalization
 * in STBL_Core.put() and YieldDistributor reward logic.
 */
contract STBL_DecimalMismatch_PoC {
    uint256 public constant MULTIPLIER = 1e18;
    uint256 public totalSupply;
    uint256 public rewardIndex;

    struct User {
        uint256 shares;
        uint256 rewardIndex;
    }

    mapping(address => User) public users;

    /**
     * @dev Replicates the vulnerable put() logic from STBL_Core.sol.
     * stableValueNet is passed directly without 10^12 normalization for 6-decimal tokens.
     */
    function deposit(address _user, uint256 _amount) external {
        users[_user].shares += _amount;
        totalSupply += _amount;
    }

    /**
     * @dev Replicates YieldDistributor.distributeReward() logic.
     */
    function distribute(uint256 _reward) external {
        require(totalSupply > 0, "No stakers in pool");
        rewardIndex += (_reward * MULTIPLIER) / totalSupply;
    }

    /**
     * @dev Replicates YieldDistributor calculation of earned rewards.
     */
    function checkEarned(address _user) public view returns (uint256) {
        User memory user = users[_user];
        uint256 pending = (user.shares * (rewardIndex - user.rewardIndex)) / MULTIPLIER;
        return pending;
    }
}
